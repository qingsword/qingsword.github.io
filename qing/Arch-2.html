<!DOCTYPE html>
<!--Copyright©QingSword.COM︻☼1010D>-->
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no">
	<meta name="description" content="晴刃,是一个致力推广实用计算机技术的个人博客;我们分享计算机知识;为计算机系统以及网络安全防范做出一份贡献。【专注技术 创造价值 共同进步】">
	<meta name="keywords" content="晴刃,晴,qing,qingsword,ccna图文笔记,ubuntu,linux,ubuntu server,mysql,node.js,javascript,python,计算机技术博客,Arch,manjora,Rust,github,php">
	<title>[Arch]-2-如何给Arch安装图形界面 - QingSword.COM</title>
	<link rel="shortcut icon" type="image/x-icon" href="../logo/favicon.ico">
	<link rel="stylesheet" type="text/css" href="../css/basic.css">
	<link rel="stylesheet" type="text/css" href="../css/text.css">
	<!-- 代码块高亮js -->
	<link type="text/css" rel="stylesheet" href="../plugins/SyntaxHighlighter/styles/shCore.css"/>
	<link type="text/css" rel="stylesheet" href="../plugins/SyntaxHighlighter/styles/shThemeRDark.css"/>
	 <script type="text/javascript" src="../plugins/SyntaxHighlighter/scripts/shCore.js"></script>
	<script type="text/javascript" src="../plugins/SyntaxHighlighter/scripts/shBrushBash.js"></script>
	<script type="text/javascript">
	SyntaxHighlighter.all();
	</script>
</head>
<body>
	<!--header -->
	<header id="nav">
			<div class="nav-container"> 
				<!-- 根大纲-->
				<a href="http://www.qingsword.com" title="晴刃">
					<h1 class="nav-logo">晴刃</h1>
				</a>
				<h2 class="nav-site-description desc-hidden">
					自由、互助、分享、专注计算机技术
				</h2>
				<nav class="nav-links"> 
					<!-- nav连接大纲-->
					<h1 style="display:none;">网站导航</h1> 
					<ul>
						<li  class="li-hidden">
							<a href="../index.html" title="home">
								<span class="link-word"><img src="../logo/home.png" alt="home" class="link-img">首页</span>
							</a>
						</li>
						<li class="li-hidden">
							<a href="../web.html" title="web">
								<span class="link-word"><img src="../logo/web.png" alt="web" class="link-img">程序<span class="word-hidden">设计</span></span>
							</a>
						</li>
						<li class="li-hidden">
							<a href="../system.html" title="system">
								<span class="link-word"><img src="../logo/linux.png" alt="linux" class="link-img">系统<span class="word-hidden">应用</span></span>
							</a>
						</li>
						<li class="li-hidden">
							<a href="../net.html" title="net">
								<span class="link-word"><img src="../logo/net.png" alt="net" class="link-img">网络<span class="word-hidden">技术</span></span>
							</a>
						</li>
						<li>
							<a href="../sitemap.html" title="sitemap">
								<span class="link-word"><img src="../logo/archives.png" alt="archives" class="link-img"><span class="word-hidden">文章</span>归档</span>
							</a>
						</li>
					</ul>
				</nav>
			</div>		
	</header>
	<!-- /header -->

	<!-- content-->
	<div id="content">
		<div class="content-container">
			<!-- 文章区 -->
			<article class="text-container">
				<header class="text-header">
					<h1>[[Arch]-2-如何给Arch安装图形界面</h1>	
				</header><!-- /header -->
				<section class="text-body">
					<h2>引言</h2>
					<p>这篇文章给大家介绍使用Arch安装Systemd启动器、显卡驱动、桌面环境、字体优化等。</p>
					<!-- 目录 -->
					<h2>文章目录</h2>
					<ul class="contents">	
						 <li><a href="#Arch-0">0×0.安装Systemd启动器</a></li>
						 <li><a href="#Arch-1">0×1.安装显卡驱动</a></li>
						 <li><a href="#Arch-2">0×2.安装桌面环境</a></li>
						 <li><a href="#Arch-3">0×3.安装微软雅黑字体</a></li>
						 <li><a href="#Arch-4">0×4.本地界面中文化配置</a></li>
					 </ul>
					<!-- /目录 -->

					<!-- 正文 -->
					<h2 id="Arch-0">0×0.安装Systemd启动器</h2>
					<pre class="brush: bash;">
					#安装Systemd启动器
					qing@qingsword.com:~$ sudo bootctl install

					#配置Systemd，在下面目录中创建一个自定义文件名的conf文件
					qing@qingsword.com:~$ sudo vim /boot/loader/entries/qingsword.conf
					#写入下面的信息
					#注意！如果你的CPU是intel，请将下面amd-ucode.img替换成intel-ucode.img
					title QingSword Arch Linux
					linux /vmlinuz-linux
					initrd /amd-ucode.img
					initrd /initramfs-linux.img

					#用df查看一下/目录所在分区，本文为/dev/sda2
					qing@qingsword.com:~$ df -h
					....
					/dev/sda2  49G  2.8G   44G   6% /

					#使用下面的命令，将/目录对应的分区的UUID，写入上面创建的"/boot/loader/entries/qingsword.conf"文件
					qing@qingsword.com:~$ su root
					...需要root权限
					root@qingsword.com:~# echo "options root=PARTUUID=$(blkid -s PARTUUID -o value /dev/sda2) rw" &gt;&gt; /boot/loader/entries/qingsword.conf
					</pre>

					<h2 id="Arch-1">0×1.安装显卡驱动</h2>
					<p>首先查看一下自己机器的显卡类型：</p>
					<pre class="brush: bash;">
					#看输出信息中包含的是AMD还是Intel或者NVIDIA
					qing@qingsword.com:~$ lspci -v |  grep -A1 -e VGA -e 3D
					...[AMD/ATI]...

					#查看有哪些可选的驱动
					qing@qingsword.com:~$ pacman -Ss xf86-video
					</pre>
					<p>不同型号的显卡驱动，可以参考这篇文章中的表格，根据不同的显卡型号，安装表格中对应的驱动：</p>
					<p>https://wiki.archlinux.org/title/Xorg</p>

					<pre class="brush: bash;">
					#首先，去掉下面文件中multilib两行前面的#号，开启32位软件下载支持
					qing@qingsword.com:~$ sudo vim /etc/pacman.conf 
					[multilib]
					Include = /etc/pacman.d/mirrorlist
					qing@qingsword.com:~$ sudo pacman -Syy

					#分支1-[AMD显卡]
					#安装AMD显卡驱动
					#安装xf86-video-amdgpu，mesa和对32位的兼容lib32-mesa
					qing@qingsword.com:~$ sudo pacman -S xf86-video-amdgpu mesa lib32-mesa lib32-vulkan-radeon libva-mesa-driver lib32-libva-mesa-driver mesa-vdpau lib32-mesa-vdpau libglvnd lib32-libglvnd

					#配置"/boot/loader/entries/qingsword.conf"文件，在rw后面，写入AMD参数"amdgpu.dpm=0 amdgpu.noretry=0"
					qing@qingsword.com:~$ sudo vim /boot/loader/entries/qingsword.conf
					options root=PARTUUID=b1e54cec-x3ec-be4d-8b9a-e4527c0f034a rw amdgpu.dpm=0 amdgpu.noretry=0


					#分支2-[Intel显卡]
					#安装Intel显卡驱动
					qing@qingsword.com:~$ sudo pacman -S xf86-video-intel mesa lib32-mesa lib32-vulkan-radeon libva-mesa-driver lib32-libva-mesa-driver mesa-vdpau lib32-mesa-vdpau libglvnd lib32-libglvnd

					#分支3-[NVIDIA显卡]
					#安装NVIDIA显卡驱动
					qing@qingsword.com:~$ sudo pacman -S mesa lib32-mesa lib32-vulkan-radeon libva-mesa-driver lib32-libva-mesa-driver mesa-vdpau lib32-mesa-vdpau libglvnd lib32-libglvnd nvidia dkms nvidia-utils lib32-nvidia-utils opencl-nvidia lib32-opencl-nvidia nvidia-settings

					#N卡驱动配置
					qing@qingsword.com:~$ sudo vim /etc/mkinitcpio.conf
					#将"nvidia nvidia_modeset nvidia_uvm nvidia_drm"按顺序写入MODULES后面的括号中
					MODULES=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)
					qing@qingsword.com:~$ su root
					....下面的配置需要root权限
					qing@qingsword.com:~# mkdir /etc/pacman.d/hooks
					qing@qingsword.com:~# vim /etc/pacman.d/hooks/nvidia.hook
					#写入下面的内容（注意大小写不能错）
					[Trigger]
					Operation=Install
					Operation=Upgrade
					Operation=Remove
					Type=Package
					Target=nvidia
					Target=linux

					[Action]
					Depends=mkinitcpio
					When=PostTransaction
					Exec=/usr/bin/mkinitcpio -P

					#配置"/boot/loader/entries/qingsword.conf"文件，在rw后面，写入NVIDIA参数"nvidia-drm.modeset=1"
					qing@qingsword.com:~$ sudo vim /boot/loader/entries/qingsword.conf
					options root=PARTUUID=b1e54cec-x3ec-be4d-8b9a-e4527c0f034a rw nvidia-drm.modeset=1

					#分支4-双显卡笔记本（未完成）
					#[Intel+Nvidia]
					#安装Intel显卡驱动
					qing@qingsword.com:~$ sudo pacman -S xf86-video-intel mesa lib32-mesa lib32-vulkan-radeon libva-mesa-driver lib32-libva-mesa-driver mesa-vdpau lib32-mesa-vdpau libglvnd lib32-libglvnd
					#安装bumblebee（未完成对bumblebee的配置，这样之后，只能使用Intel卡，相当于放弃N卡的使用）
					qing@qingsword.com:~$ sudo pacman -S bumblebee
					</pre>

					<h2 id="Arch-2">0×2.安装桌面环境</h2>
					<p>KDE桌面安装参考：https://wiki.archlinux.org/title/KDE</p>
					<pre class="brush: bash;">
					#安装xorg桌面基础架构
					qing@qingsword.com:~$ sudo pacman -S xorg xorg-apps xorg-server xorg-xinit xorg-twm xorg-xclock xterm konsole
					
					#分支1-[KDE plasma桌面]
					#KDE-plasma桌面，sddm显示管理器
					#以及kde-applications全套软件包（可选，包含的软件列表参考：https://archlinux.org/groups/x86_64/kde-applications/）
					qing@qingsword.com:~$ sudo pacman -Syyu plasma kde-applications sddm
					#sddm随机启动
					qing@qingsword.com:~$ sudo systemctl enable sddm

					#分支2-[deepin桌面] 
					#安装deepin桌面环境，以及deepin-extra桌面环境组件
					 qing@qingsword.com:~$ sudo pacman -S deepin deepin-extra
					#编辑lightdm.conf文件
					#将"greeter-session=example-gtk-gnome"去掉前面的#注释符号
					#改成"greeter-session=lightdm-deepin-greeter"
					 qing@qingsword.com:~$ sudo vim /etc/lightdm/lightdm.conf
					#随机启动lightdm
					 qing@qingsword.com:~$ sudo systemctl enable lightdm
					</pre>

					<h2 id="Arch-3">0×3.安装微软雅黑字体</h2>

					<p>基于一些兼容性的考虑，在安装微软雅黑字体前，一般会去装一些开源中文字体，个人总结出下面这些比较好用的字体，先安装上：</p>
					<pre class="brush: bash;">
					#安装开源中文字体
					 qing@qingsword.com:~$ sudo pacman -S wqy-microhei wqy-microhei-lite wqy-zenhei noto-fonts noto-fonts-cjk noto-fonts-emoji ttf-dejavu ttf-liberation ttf-fireflysung
					</pre>
					<p>安装微软雅黑字体，先找台Windows机器，在文件夹地址栏输入"C:\Windows\Fonts\Microsoft YaHei UI"就能查找到微软雅黑的常规字体，将这个字体复制出来备用。</p>
					<p>在Arch下创建Windows字体存放目录：</p>
					<pre class="brush: bash;">
					#创建目录，将刚才拷贝的微软雅黑字体文件复制到这个目录下面
					 qing@qingsword.com:~$ sudo mkdir /usr/share/fonts/WindowsFonts
					#更改权限
					 qing@qingsword.com:~$ sudo chmod 755 /usr/share/fonts/WindowsFonts
					#切换到目录中，创建刷新字体缓存
					 qing@qingsword.com:~$ cd /usr/share/fonts/WindowsFonts
					 qing@qingsword.com:~$ sudo mkfontscale &amp;&amp; sudo mkfontdir &amp;&amp; sudo fc-cache -fv
					</pre>

					<h2 id="Arch-4">0×4.本地界面中文化配置</h2>
					<p>到目前为止，图形界面还是英文的语言环境，可以使用下面的方法替换成中文环境，为了防止乱码，请先参考文章第三部分安装中文字体，中文字体如果没有安装，会出现乱码：</p>
					<pre class="brush: bash;">
					#编辑本地语言环境配置文件，建议用root用户修改
					 qing@qingsword.com:~$ passwd root
					 qing@qingsword.com:~# vim /etc/locale.gen
					#搜索"zh_CN.UTF-8"和"en_US.UTF-8"两行都去掉前面的#号
					#让语言生效输入下面的命令
					 qing@qingsword.com:~# locale-gen
					#配置本地语言环境为中文
					 qing@qingsword.com:~# echo "LANG=zh_CN.UTF-8"&gt;/etc/locale.conf
					</pre>
					<p>通过这一步的操作，重启之后进入桌面环境，在配置中搜索language，就能修改系统语言为微软雅黑，界面字体看起来也相对比较舒服了。</p>
				<!-- /正文 -->

				<footer class="text-footer">
					<p>
						*转载请注明来自:<a title="晴刃-自由、互助、分享、专注计算机技术。" href="http://www.qingsword.com" target="_blank">晴刃(QingSword.COM)</a>
					</p>
					<p>*原文连接:<a title="[Arch]-2-如何给Arch安装图形界面" href="http://www.qingsword.com/qing/Arch-2.html" target="_blank">http://www.qingsword.com/qing/Arch-2.html</a></p>
				</footer>
			</article>
			<!-- /文章区 -->	
		</div>
	</div>
	<!-- /content -->
	
	<!-- footer -->
	<footer id="footer">
		<div class="footer-container">
			QingSword.COM &nbsp;<img src="../logo/by-nc-sa.png" alt="Creative Commons" title="Creative Commons">
		</div>
	</footer>
	<!-- /footer -->
</body>
</html>
